@inherits LayoutComponentBase
@implements IDisposable
@inject frontend.Services.AuthService Auth

<Navbar Left="left" Right="@RightLinks" RightContent="@ProfileContent" />

<div class="page">
    <main>
        @Body
    </main>
</div>

@code {
    private readonly NavLinkItem[] left = new[]
    {
        new NavLinkItem("Home", "/"),
        new NavLinkItem("Forum", "/forum"),
        new NavLinkItem("Devlog", "/devlog")
    };

    private readonly NavLinkItem[] right = new[]
    {
        new NavLinkItem("Register", "/register"),
        new NavLinkItem("Login", "/login")
    };

    private IEnumerable<NavLinkItem>? RightLinks => Auth.IsAuthenticated ? null : right;

    private RenderFragment? ProfileContent => Auth.IsAuthenticated ? builder =>
    {
        builder.OpenComponent<ProfileMenu>(0);
        builder.CloseComponent();
    } : null;

    protected override void OnInitialized()
    {
        Auth.AuthenticationStateChanged += HandleAuthChanged;
    }

    private void HandleAuthChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        Auth.AuthenticationStateChanged -= HandleAuthChanged;
    }
}
